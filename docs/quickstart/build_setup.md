# Build and Setup

## Deploy your instance

The CLI supports two deployment modes: local development and containerized *semi*-production. This document will focus on deploying a containerized *semi*-production instance (we will use the `--containers` flag throughout). To deploy for local development, replace that flag by `--local`.

Before going on, let's move into the project directory:

``` console
$ cd december-release
```

**Known issues**:

- If you do not move into the correct directory you will get an error like this:
```
ERROR:root:No flavour specified.
```

The error message is not intuitive: it is not because no flavour was specified that there is an error! We will change it. It just means that the folder does not contain the `.invenio` config file because the current directory is wrong: *cd into it :-)*.

### Build the docker images

We use the `build` command with the `--containers` flag to build the images specified in the `december-release/docker-compose.full.yml`.
In addition, we need to add ``--pre`` in order to allow `pipenv` to install alpha releases, since many InvenioRDM packages are now in this phase. Be patient, the docker images might take some time to build.

``` console
(your-virtualenv)$ invenio-cli build --pre --containers
Building RDM application...
Locking dependencies...
Bootstrapping server...
Building base docker image...
Building applications docker image...
Creating services...
```

As a result, six images (December-Release, Nginx, Redis, PostgreSQL, RabbitMQ and Elasticsearch) have been built.

### Setup the DB, ES and others

We just need to initialize the database, the indices and so on. For this, we can use the `setup` command. Note that this command is only needed once. Afterwards, you can stop (not destroy) your instance and start again, and your data will still be there.

``` console
(your-virtualenv)$ invenio-cli setup --containers
Setting up environment for RDM application...
Setting up server...
Starting containers...
Creating database...
Creating indexes...
Creating files location...
Creating admin role...
Assigning superuser access to admin role...
Stopping containers...
```

In case you want to wipe out the data that was there (say to start fresh), you can use `--force` and nuke the content!

``` console
(your-virtualenv)$ invenio-cli setup --containers --force
Setting up environment for RDM application...
Setting up server...
Starting containers...
Flushing redis cache...
Deleting database...
Deleting indexes...
Purging queues...
Creating database...
Creating indexes...
Creating files location...
Creating admin role...
Assigning superuser access to admin role...
Stopping containers...
```

### Populate DB

Let's add some content so you can interact a bit with the instance. For this you will generate 10 random demo records, using the `demo` command:

``` console
(your-virtualenv)$ invenio-cli demo --containers
Setting up server...
Starting containers...
Populating instance with demo records...
```
